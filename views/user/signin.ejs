<%- include("../partials/header", { title: title }) %>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="container my-5 d-flex flex-column align-items-center">

    <!-- Page Title -->
    <h3 class="fw-semibold">Next Step</h3>
    <p class="text-muted mb-4">Premium Shoes for Everyone</p>

    <!-- Card -->
    <div class="card shadow-sm p-4" style="width: 100%; max-width: 420px; border-radius: 8px;">

        <h5 class="mb-3">Sign In</h5>

        <form action="/signin" method="POST" id="signinForm">

            <!-- Email -->
            <div class="mb-3">
                <label class="form-label small">Email Address</label>
                <input type="email" name="email" class="form-control form-control-sm" placeholder="Enter your email" required>
            </div>

            <!-- Password -->
            <div class="mb-3 position-relative">
                <label class="form-label small">Password</label>
                <input type="password" name="password" id="passwordInput" class="form-control form-control-sm" placeholder="Enter your password" required>
                <i class="bi bi-eye position-absolute" id="togglePassword"
                   style="right: 10px; top: 38px; cursor: pointer;"></i>
            </div>

            <!-- Remember + Forgot -->
            <div class="d-flex justify-content-between align-items-center mb-3 small">
                <div>
                    <input type="checkbox" name="remember"> Remember me
                </div>
                <a href="/forgotPassword" class="text-decoration-none">Forgot password?</a>
            </div>

            <!-- Sign In Button -->
            <button type="submit" class="btn btn-dark w-100 btn-sm">
                Sign In
            </button>

            <!-- Signup -->
            <p class="text-center small mt-3 mb-0">
                Don't have an account?
                <a href="/signup" class="text-decoration-none">Sign Up</a>
            </p>

        </form>

    </div>

</div>

<script>
    // Toggle password visibility
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('passwordInput');

    togglePassword.addEventListener('click', function() {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        this.classList.toggle('bi-eye');
        this.classList.toggle('bi-eye-slash');
    });

    // Show error message if exists
    <% if (error) { %>
        Swal.fire({
            icon: 'error',
            title: 'Login Failed',
            text: '<%= error %>',
            confirmButtonColor: '#212529'
        });
    <% } %>

    // Show success message for password reset
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('reset') === 'success') {
        Swal.fire({
            icon: 'success',
            title: 'Password Reset Successful!',
            text: 'You can now sign in with your new password',
            confirmButtonColor: '#28a745'
        });
        // Clean URL
        window.history.replaceState({}, document.title, window.location.pathname);
    }

    // Form submission with loading
    document.getElementById('signinForm').addEventListener('submit', function(e) {
        const email = document.querySelector('input[name="email"]').value;
        const password = document.querySelector('input[name="password"]').value;

        if (!email || !password) {
            e.preventDefault();
            Swal.fire({
                icon: 'warning',
                title: 'Missing Information',
                text: 'Please fill in all fields',
                confirmButtonColor: '#212529'
            });
        }
    });
</script>

<%- include("../partials/footer") %>
